function HashMap(){var size=0;var entry=new Object();this.put=function(key,value){if(!this.containsKey(key)){size++}entry[key]=value};this.get=function(key){if(this.containsKey(key)){return entry[key]}else{return null}};this.remove=function(key){if(delete entry[key]){size--}};this.containsKey=function(key){return(key in entry)};this.containsValue=function(value){for(var prop in entry){if(entry[prop]==value){return true}}return false};this.values=function(){var values=new Array();for(var prop in entry){values.push(entry[prop])}return values};this.keys=function(){var keys=new Array();for(var prop in entry){keys.push(prop)}return keys};this.size=function(){return size}};if(typeof(App)=='undefined'){App={}}App.Ajax={_defConfig:{url:'',dataType:"json",async:true,isAutoTip:true},request:function(config){config=$.extend({},this._defConfig,config||{});var succFn=config.success;var failFn=config.failure||config.error;var isAutoTip=config.isAutoTip;$.ajax({url:config.url,type:config.type||config.method||'post',data:config.params||config.data||{},dataType:config.dataType,async:config.async,success:function(resp){if(resp.success==null)resp.success=true;App.Ajax.succOper(resp,succFn,failFn,isAutoTip)},error:function(resp,textStatus,errorThrown){if(resp.status==200){App.Ajax.succOper(resp,succFn,failFn,isAutoTip)}else{App.Ajax.errorHandler(resp,this.url)}}})},succOper:function(resp,succFn,failFn,isAutoTip){if(resp){if(resp.success&&resp.returnCode==200){if($.isFunction(succFn)){succFn(resp)}App.Ajax.showTip(resp.msg,isAutoTip,true)}else{if($.isFunction(failFn)){failFn(resp)}else{isAutoTip=true}App.Ajax.showTip(resp.error||resp.msg,isAutoTip,false)}}else{App.Ajax.showTip(App.ajax.emptyresponse,true,false)}},showTip:function(msg,isAutoTip,success){if(isAutoTip==true){if(typeof(MsgBox)!='undefined'){if(success){MsgBox.msg(msg||App.msg.successful)}else{MsgBox.dialog({title:msg||App.msg.failure,type:"error",through:false})}}else{alert(msg||(success?App.msg.successful:App.msg.failure))}}},errorHandler:function(resp,url){var status=resp.status;if(status=='0'){App.Ajax.showTip(App.ajax.status0,true,false)}else if(status=='1'){App.Ajax.showTip(App.ajax.status1,true,false)}else if(status=='404'){App.Ajax.showTip('url "'+url+'" '+App.ajax.status404,true,false)}else if(status=='408'){App.Ajax.showTip(App.ajax.status408,true,false)}else if(status=='405'){App.Ajax.showTip(App.ajax.status405,true,false)}else if(status=='500'){App.Ajax.showTip(App.ajax.status500,true,false)}else if(status=='503'){App.Ajax.showTip(App.ajax.status503,true,false)}else{App.Ajax.showTip(App.ajax.statusfail+' : '+status,true,false)}},parseData:function(data){if(typeof data=='undefined'){data={}}else if(typeof data=='string'){data=JSON.parse(data)}return data},callback:function(resp,succFn,failFn){if(resp.success){if($.isFunction(succFn)){succFn(resp)}}else{if($.isFunction(failFn)){failFn(resp)}}},jsonp:function(config){var url=config.url||"";if(url.indexOf('callback')==-1){if(url.indexOf('?')==-1){url+='?callback=?'}else{url+='&callback=?'}}$.getJSON(url,config.params||{},function(data){if($.isFunction(config.callback)){config.callback(data)}})},upload:function(config){if(!config.url&&!config.contextPath){App.Ajax.showTip('请传入url参数或contextPath参数',true,false);return}var form=config.form;if(typeof form=='undefined'){App.Ajax.showTip('请传入form参数',true,false);return}else if(typeof form=='string'){if(form.indexOf('#')==-1)form='#'+form;form=$(form)[0]}else if(form.selector){form=form[0]}var url=config.url||config.contextPath+'/files/upload.do';var param='fileSingleSizeLimit='+(config.fileSingleSizeLimit||0);if(config.modelName){param+='&modelName='+config.modelName}if(config.compress){var compress=false,width=0,height=0,scale=0,compressSize=0,compressGIF=false;if($.isPlainObject(config.compress)){compress=true;width=config.compress.width||0;height=config.compress.height||0;scale=config.compress.scale||0;compressSize=config.compress.compressSize||0;compressGIF=config.compress.compressGIF==true?true:false}else if(config.compress==true){compress=true;scale=1}if(compress){param+='&compress=true&width='+width+'&height='+height+'&scale='+scale+'&compressSize='+compressSize+'&compressGIF='+compressGIF}}if(url.indexOf('?')==-1){url+='?'+param}else{url+='&'+param}var formData=new FormData(form);var succFn=config.success;var failFn=config.failure||config.error;var isAutoTip=config.isAutoTip==null?false:config.isAutoTip;$.ajax({url:url,type:'POST',data:formData,processData:false,contentType:false,success:function(resp){if(resp.success==null)resp.success=true;resp.data=App.Ajax.parseData(resp.data);App.Ajax.succOper(resp,succFn,failFn,isAutoTip)},error:function(resp,textStatus,errorThrown){resp.data=App.Ajax.parseData(resp.data);if(resp.status==200){App.Ajax.succOper(resp,succFn,failFn,isAutoTip)}else{App.Ajax.errorHandler(resp,url)}}})},submit:function(options){var form=options.form;if(typeof form=='undefined'){return alert('请传入form参数')}else if(typeof form=='string'){if(form.indexOf('#')==-1)form='#'+form;form=$(form)}else if(form.selector){}else{form=$(form)}var succFn=options.success||options.callback;var failFn=options.failure||options.error;var isAutoTip=options.isAutoTip==null?true:options.isAutoTip;options=$.extend(options,{success:function(resp,statusText){if(resp.success==null&&resp.returnCode==200)resp.success=true;if(isAutoTip==true){if(typeof(MsgBox)!='undefined'){MsgBox.alert(App.msg.successful,function(){App.Ajax.callback(resp,succFn,failFn)})}else{alert(App.msg.successful);App.Ajax.callback(resp,succFn,failFn)}}else{App.Ajax.callback(resp,succFn,failFn)}}});form.ajaxSubmit(options)}};App.Date={parse:function(date){if(!date)return null;if(typeof(date)=="string"){var dates=date.split(' ');if(dates[0].length>8){date=date.replace('-','/').replace('-','/');date=date.replace('年','/').replace('月','/').replace('日','');date=date.replace('时',':').replace('分',':').replace('秒','')}else{var year=dates[0].substring(0,4);var month=dates[0].substring(4,6);var day=dates[0].substring(6,8);date=year+'/'+month+'/'+day+' ';if(dates.length>1){date=date+' '+dates[1]}}return new Date(date)}else if(typeof(date)=="object"){return new Date(date)}else{alert(App.date.invalidformat)}},format:function(date,fmt){var d=this.parse(date);var o={"M+":d.getMonth()+1,"d+":d.getDate(),"h+":d.getHours()%12==0?12:d.getHours()%12,"H+":d.getHours(),"m+":d.getMinutes(),"s+":d.getSeconds(),"q+":Math.floor((d.getMonth()+3)/ 3), /*季度*/"S":d.getMilliseconds()};var week={"0":"\u65e5","1":"\u4e00","2":"\u4e8c","3":"\u4e09","4":"\u56db","5":"\u4e94","6":"\u516d"};if(/(y+)/.test(fmt)){fmt=fmt.replace(RegExp.$1,(d.getFullYear()+"").substr(4-RegExp.$1.length))}if(/(E+)/.test(fmt)){fmt=fmt.replace(RegExp.$1,((RegExp.$1.length>1)?(RegExp.$1.length>2?"\u661f\u671f":"\u5468"):"")+week[d.getDay()+""])}for(var k in o){if(new RegExp("("+k+")").test(fmt)){fmt=fmt.replace(RegExp.$1,(RegExp.$1.length==1)?(o[k]):(("00"+o[k]).substr((""+o[k]).length)))}}return fmt},compare:function(date1,date2){var d1=this.parse(date1);var d2=this.parse(date2);if(d1&&d2){return d1>d2}return null},addDay:function(date,n){var d=this.parse(date);d=d.valueOf();d=d+n*24*60*60*1000;return new Date(d)}};App.Cookie={create:function(name,value,days){if(days){var date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));var expires="; expires="+date.toGMTString()}else{expires=""}value=encodeURI(encodeURI(value));document.cookie=name+"="+value+expires+"; path=/"},read:function(name){var nameEQ=name+"=",ca=document.cookie.split(';'),i,c,len=ca.length;for(i=0;i<len;i++){c=ca[i];while(c.charAt(0)==' '){c=c.substring(1,c.length)}if(c.indexOf(nameEQ)==0){var value=c.substring(nameEQ.length,c.length);value=decodeURI(decodeURI(value));return value}}return null},clear:function(name){document.cookie=name+"="+"; path=/"}};App.MsgBox={Constant:{MSG_TIME:3000},dialog:function(options){options=options||{};var callback=options.callback;var cancelFn=options.cancelFn;options=$.extend(options,{title:options.title||options.msg,confirmButtonText:App.msg.confirmBtnText,cancelButtonText:App.msg.cancelBtnText});if(typeof(swal)=='undefined'){alert(options.title||'swal组件未引入！');return}var through=false;if(options.through==true)through=true;if(through==true&&window.parent&&window.parent.frames.length<=2){swal=parent.swal}if(options.type=='input'){var allowBlank=options.allowBlank;swal(options,function(inputValue){if(inputValue===false)return false;if(eval(allowBlank)==false&&inputValue===""){swal.showInputError(App.msg.inputError);return false}if($.isFunction(callback)){callback(inputValue)};swal.close()})}else if($.isFunction(callback)){swal(options,function(v){if(v){callback(v)}else{if($.isFunction(cancelFn)){cancelFn()}}})}else{swal(options)}},msg:function(msg){this.dialog({title:msg})},msgHide:function(msg){this.dialog({title:msg,timer:this.Constant.MSG_TIME})},warn:function(msg){this.dialog({title:msg,type:"warning",through:true})},warnHide:function(msg){this.dialog({title:msg,type:"warning",through:true,timer:this.Constant.MSG_TIME})},warnUpdate:function(){var msg=App.msg.warnUpdate;this.dialog({title:msg,type:"warning",through:true})},warnDelete:function(){var msg=App.msg.warnDelete;this.dialog({title:msg,type:"warning",through:true})},succ:function(msg){this.dialog({title:msg,type:"success"})},succHide:function(msg){this.dialog({title:msg,type:"success",timer:this.Constant.MSG_TIME})},error:function(msg){this.dialog({title:msg,type:"error",through:true})},errorHide:function(msg){this.dialog({title:msg,type:"error",through:true,timer:this.Constant.MSG_TIME})},confirmEx:function(options){options=options||{};var yesFn=options.callback||options.yesFn;var noFn=options.cancelFn||options.noFn;options=$.extend(options,{title:options.title||options.msg,type:"warning",showCancelButton:true,confirmButtonColor:"#DD6B55",closeOnConfirm:false,closeOnCancel:true,callback:yesFn,cancelFn:noFn});this.dialog(options)},confirm:function(msg,yesFn,noFn){this.confirmEx({title:msg,callback:yesFn,cancelFn:noFn,through:true})},confirmDelete:function(yesFn,noFn){var msg=App.msg.confirmDelete;this.confirm(msg,yesFn,noFn)},alert:function(msg,callback){this.dialog({title:msg,callback:callback})},promptEx:function(options){options=options||{};var inputValue=options.inputValue||options.value;var placeholder=options.inputPlaceholder||options.placeholder;options=$.extend(options,{title:options.title||options.msg,type:"input",showCancelButton:true,closeOnConfirm:false,animation:"slide-from-top",inputPlaceholder:placeholder,inputValue:inputValue});this.dialog(options)},prompt:function(msg,callback,value){this.promptEx({title:msg,inputValue:value,callback:callback})}};MsgBox=App.MsgBox;App.Window={_defConfig:{fix:false,maxmin:true,width:800,height:580,through:true},open:function(config){config=$.extend({},this._defConfig,config);config=$.extend(config,{type:2,area:[config.width+'px',config.height+'px'],title:'<i class="fa fa-desktop">?</i>'+(config.title||App.window.title),content:config.url});if(config.through==true&&window.parent){layer=parent.layer}if(config.fullScreen==true){config=$.extend(config,{maxmin:false,move:false,area:['99%','98%']})}var index=layer.open(config);if(!layer.WindowCallback){layer.WindowCallback=new HashMap()}layer.WindowCallback.put(index,config.callback);return index},close:function(index){if(layer.WindowCallback){var cb=layer.WindowCallback.get(index);if($.isFunction(cb)){cb();layer.WindowCallback.remove(index)}}layer.close(index)},shut:function(windowName,returnValue){var index=parent.layer.getFrameIndex(windowName);if(parent.layer.WindowCallback){var cb=parent.layer.WindowCallback.get(index);if($.isFunction(cb)){cb(returnValue);parent.layer.WindowCallback.remove(index)}}parent.layer.close(index)}};App.Editor=function(options){wangEditor.config.printLog=false;var dom=options.dom,autoCreate=options.autoCreate;var url=Config.ROOT+'/files/uploadWangEditor.do';url+='?fileSingleSizeLimit='+(options.fileSingleSizeLimit||0);if(options.compress){var compress=false,width=0,height=0,scale=0,compressSize=0,compressGIF=false;if($.isPlainObject(options.compress)){compress=true;width=options.compress.width||0;height=options.compress.height||0;scale=options.compress.scale||0;compressSize=options.compress.compressSize||0;compressGIF=options.compress.compressGIF==true?true:false}else if(options.compress==true){compress=true;scale=1}if(compress){url+='&compress=true&width='+width+'&height='+height+'&scale='+scale+'&compressSize='+compressSize+'&compressGIF='+compressGIF}}var editor=new wangEditor(dom);editor.config.uploadImgUrl=url;editor.config.menus=$.map(wangEditor.config.menus,function(item,key){if(item==='emotion'){return null}return item});if(autoCreate==null||autoCreate==true){editor.create()}return editor};
